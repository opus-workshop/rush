id: '2.8'
title: 'Event: Auto-compress verbose tool results'
slug: event-auto-compress-verbose-tool-results
status: closed
priority: 2
created_at: 2026-02-03T08:51:36.411933Z
updated_at: 2026-02-03T09:05:19.595570Z
description: "## What to implement\nAdd a `tool_result` event handler that automatically compresses verbose output.\n\n## Files\n- ~/.pi/agent/extensions/8b-tools/events/auto-compress.ts\n\n## Implementation\n```typescript\n// In index.ts\npi.on(\"tool_result\", async (event, ctx) => {\n  // Only compress bash results over threshold\n  if (event.toolName !== \"bash\") return;\n  \n  const text = getTextContent(event.content);\n  if (!text || text.length < 5000) return;  // Only compress large outputs\n  \n  // Compress using 8B\n  const compressed = await compress8B(text, { focus: \"errors,warnings,summary\" });\n  \n  // Return modified result\n  return {\n    content: [{ type: \"text\", text: compressed }],\n    details: { \n      ...event.details,\n      originalLength: text.length,\n      compressed: true \n    }\n  };\n});\n```\n\n## Configuration\n- Threshold: 5000 chars (configurable)\n- Only for bash tool (most verbose)\n- Preserves errors/warnings prominently\n- Adds note about compression\n\n## Acceptance\n- Hooks into tool_result event\n- Only triggers for large bash outputs\n- Compresses to key points\n- Original available in details if needed"
closed_at: 2026-02-03T09:05:19.595570Z
close_reason: Added tool_result event handler that auto-compresses verbose bash outputs over 5000 chars using 8B compress. Returns compressed summary with original length preserved in details.
parent: '2'
verify: grep -q "tool_result" ~/.pi/agent/extensions/8b-tools/index.ts
claimed_at: 2026-02-03T09:04:46.979547Z
is_archived: true
produces:
- auto_compress_event
requires:
- CerebrasClient
- 8b_compress_tool
