id: '193.4'
title: Arbitrary FD redirection (N>&M syntax)
slug: arbitrary-fd-redirection-nm-syntax
status: closed
priority: 1
created_at: 2026-02-02T01:08:23.326929Z
updated_at: 2026-02-02T09:39:29.136878Z
description: |-
  Implement arbitrary file descriptor redirection per POSIX.

  ## POSIX Specification
  Redirections can specify any file descriptor:
  - N>file - redirect FD N to file
  - N>&M - duplicate output FD M to FD N
  - N<&M - duplicate input FD M to FD N
  - N>&- - close FD N
  - {varname}>&N - allocate FD >= 10, assign to varname (POSIX.1-2024)

  ## Examples
  ```sh
  exec 3>output.txt       # Open FD 3 for writing
  echo "test" >&3         # Write to FD 3
  exec 3>&-               # Close FD 3

  command 3>&1 1>&2 2>&3  # Swap stdout and stderr
  ```

  ## Implementation
  - Parser: extract FD number prefix from redirect operators
  - Lexer: handle numeric prefix before <, >, etc.
  - Executor: use dup2() for FD management
  - Track open FDs in runtime for cleanup

  ## Files to Modify
  - src/lexer/mod.rs - recognize FD numbers
  - src/parser/mod.rs - parse FD redirections
  - src/parser/ast.rs - Redirection struct with source_fd
  - src/executor/mod.rs - implement FD duplication
acceptance: Support N>file, N>&M, N<&M for arbitrary file descriptors; handle {varname}>&N for dynamic FD allocation
labels:
- posix
- io
- redirection
closed_at: 2026-02-02T09:39:29.136878Z
parent: '193'
verify: cargo test arbitrary_fd_redirect
claimed_at: 2026-02-02T09:39:29.123764Z
is_archived: true
