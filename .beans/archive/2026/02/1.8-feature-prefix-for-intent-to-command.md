id: '1.8'
title: 'Feature: `?` prefix for intent-to-command'
slug: feature-prefix-for-intent-to-command
status: closed
priority: 3
created_at: 2026-02-03T08:38:48.199848Z
updated_at: 2026-02-03T09:27:31.382490Z
description: "**Future enhancement** - The `?` prefix converts natural language to shell commands.\n\n```bash\n$ ? find all rust files modified today\n# Pi generates: find . -name \"*.rs\" -mtime 0\n# Shows preview, user confirms with Enter or edits\n\n$ ? deploy to staging  \n# Pi generates: git push origin main && ssh staging \"./deploy.sh\"\n```\n\n## Behavior\n1. User types `? <natural language>`\n2. Rush sends to Pi with context (cwd, history, project type)\n3. Pi returns suggested command(s)\n4. Rush shows preview with syntax highlighting\n5. User can:\n   - Press Enter to execute\n   - Press Tab to edit\n   - Press Ctrl-C to cancel\n\n## Implementation Notes\n- This is a follow-on to `|?`, uses same IPC infrastructure\n- Different message type: `RushToPi::Intent` \n- Pi response includes command + explanation\n- Integrates with reedline for the preview/edit UI\n\n## Out of Scope for Initial Release\nThis is tracked for V2. Focus on `|?` first."
acceptance: |-
  1. `? find large files` shows a suggested command
  2. User can accept, edit, or cancel
  3. Accepted commands are executed and added to history
  4. Works with project context (knows it's a rust project, etc.)
closed_at: 2026-02-03T09:27:31.382490Z
close_reason: "Feature `? prefix for intent-to-command` is fully implemented:\n\n1. **Protocol Layer** (`src/daemon/protocol.rs`):\n   - `RushToPi::Intent` message type for sending natural language intents\n   - `PiToRush::SuggestedCommand` response with command, explanation, and confidence\n\n2. **Client Layer** (`src/daemon/pi_client.rs`):\n   - `PiClient::intent()` method to send intent queries to Pi daemon\n\n3. **Intent Module** (`src/intent/mod.rs`):\n   - `is_intent_query()` - detects `? ` prefix\n   - `extract_intent()` - extracts natural language from input\n   - `detect_project_type()` - detects Cargo.toml/package.json/etc\n   - `build_shell_context()` - builds context with cwd, history, env\n   - `query_intent()` - sends intent to Pi and gets suggestion\n   - `display_suggestion()` - shows command with syntax highlighting\n   - `prompt_user_action()` - handles Enter/Tab/Ctrl-C input\n   - `process_intent()` - main entry point orchestrating the flow\n\n4. **Shell Integration** (`src/main.rs`):\n   - Main loop detects `? ` prefix before normal parsing\n   - Handles Accept → executes command, updates history\n   - Handles Edit → shows command for user to copy\n   - Handles Cancel → does nothing\n\n5. **Tests**: 5 unit tests covering detection, extraction, and context building\n\nAll acceptance criteria met:\n- `? find large files` shows suggested command via Pi\n- User can accept (Enter), edit (Tab), or cancel (Ctrl-C/Esc)  \n- Accepted commands execute and add to history\n- Project type detected from cwd (rust, node, python, etc.)"
parent: '1'
claimed_at: 2026-02-03T09:24:26.866570Z
is_archived: true
