id: '195.1'
title: 'SCRIPT-BUG: Loop variables empty or wrong in scripts'
slug: script-bug-loop-variables-empty-or-wrong-in-script
status: closed
priority: 1
created_at: 2026-02-02T04:19:16.738383Z
updated_at: 2026-02-02T22:06:14.975834Z
description: "## Problem\nIn scripts, for-loop variables are empty or show wrong values:\n\n```bash\n# Script: test.sh\nfor x in A B C; do echo \"\"; done\n```\n\nExpected output:\n```\nA\nB\nC\n```\n\nActual output (varies):\n```\nC\nC\nC\n```\nor:\n```\n(empty)\n(empty)  \n(empty)\n```\n\nInteractive mode works correctly.\n\n## Root Cause\nThis is a symptom of bean #195 (line-by-line execution). When single-line loops run in script mode, the variable binding happens at parse time rather than execution time, or the loop body executes in a different scope.\n\n## Related\n- Parent: #195 (line-by-line execution)\n\n## Acceptance Criteria\n- [ ] `for x in A B C; do echo ; done` in script outputs A, B, C\n- [ ] Loop counter works: `for i in 1 2 3; do echo 0; done` â†’ 2, 4, 6\n- [ ] Nested loops work correctly\n- [ ] Same behavior in interactive and script mode\n\n## Files\n- src/main.rs (script execution)\n- src/executor/mod.rs (for loop execution)"
closed_at: 2026-02-02T22:06:14.975834Z
parent: '195'
verify: printf "for x in A B C; do echo \$x; done\n" > /tmp/loop_test.sh && rush /tmp/loop_test.sh 2>&1 | tr "\n" "," | grep -q "A,B,C,"
attempts: 1
claimed_at: 2026-02-02T21:59:26.576799Z
is_archived: true
