id: '200.3'
title: 'Parameter expansion: pattern removal ${var%} ${var#}'
slug: parameter-expansion-pattern-removal-var-var
status: closed
priority: 2
created_at: 2026-02-02T17:21:03.091655Z
updated_at: 2026-02-02T21:36:40.450776Z
description: "## What to implement\nAdd support for suffix and prefix pattern removal operators.\n\n## POSIX Semantics\n- `${var%pattern}` - Remove shortest suffix matching pattern\n- `${var%%pattern}` - Remove longest suffix matching pattern\n- `${var#pattern}` - Remove shortest prefix matching pattern\n- `${var##pattern}` - Remove longest prefix matching pattern\n\n## Examples\n```bash\nfile=\"path/to/file.txt\"\necho ${file%.txt}    # path/to/file\necho ${file%.*}      # path/to/file  \necho ${file%%.*}     # path/to/file (same if only one dot)\necho ${file#*/}      # to/file.txt\necho ${file##*/}     # file.txt\n```\n\n## Implementation\nAdd cases to `expand_braced_variable()`:\n\n```rust\n// Suffix removal (longest first to avoid prefix match issues)\nif let Some(pos) = expr.find(\"%%\") {\n    let var_name = &expr[..pos];\n    let pattern = &expr[pos + 2..];\n    let value = self.runtime.get_variable(var_name).unwrap_or_default();\n    return remove_longest_suffix(&value, pattern);\n}\nif let Some(pos) = expr.find('%') {\n    let var_name = &expr[..pos];\n    let pattern = &expr[pos + 1..];\n    let value = self.runtime.get_variable(var_name).unwrap_or_default();\n    return remove_shortest_suffix(&value, pattern);\n}\n\n// Prefix removal (check ## before # to avoid issues)\nif let Some(pos) = expr.find(\"##\") {\n    // ... similar logic\n}\nif let Some(pos) = expr.find('#') {\n    // Note: must check this doesn't conflict with ${#var} length\n    // ...\n}\n```\n\nPattern matching should support:\n- `*` - match any string\n- `?` - match single character\n- Simple literal matching\n\n## Files\n- src/executor/mod.rs (expand_braced_variable function, ~line 1154)\n\n## Depends On\n- 200.1 (must handle `#` for length before prefix removal)\n\n## Acceptance\n- [ ] `${x%.txt}` removes .txt suffix\n- [ ] `${x%.*}` removes from last dot\n- [ ] `${x%%.*}` removes from first dot\n- [ ] `${x#*/}` removes up to first /\n- [ ] `${x##*/}` removes up to last /\n- [ ] Literal patterns work (no wildcards)\n- [ ] Wildcard patterns work"
closed_at: 2026-02-02T21:36:40.450776Z
parent: '200'
verify: rush -c "x=hello.txt; echo \${x%.txt}" | grep -q hello
claimed_at: 2026-02-02T21:35:29.318395Z
is_archived: true
