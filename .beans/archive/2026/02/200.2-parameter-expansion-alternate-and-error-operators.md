id: '200.2'
title: 'Parameter expansion: alternate and error operators ${var:+} ${var:?}'
slug: parameter-expansion-alternate-and-error-operators
status: closed
priority: 2
created_at: 2026-02-02T17:20:50.158762Z
updated_at: 2026-02-02T21:35:09.028723Z
description: |-
  ## What to implement
  Add support for `:+` (use alternate) and `:?` (error if unset) operators.

  ## POSIX Semantics
  - `${var:+alternate}` - If var is set and non-empty, substitute alternate; otherwise empty
  - `${var:?message}` - If var is unset or null, print message to stderr and exit

  ## Current State
  - `:+` returns empty instead of the alternate value
  - `:?` not implemented at all

  ## Implementation
  Add cases to `expand_braced_variable()` in executor:

  ```rust
  // Use alternate if set
  if let Some(pos) = expr.find(":+") {
      let var_name = &expr[..pos];
      let alternate = &expr[pos + 2..];
      return self.runtime
          .get_variable(var_name)
          .filter(|v| !v.is_empty())
          .map(|_| alternate.to_string())
          .unwrap_or_default();
  }

  // Error if unset
  if let Some(pos) = expr.find(":?") {
      let var_name = &expr[..pos];
      let message = &expr[pos + 2..];
      if self.runtime.get_variable(var_name).map_or(true, |v| v.is_empty()) {
          eprintln!("{}: {}", var_name, message);
          // TODO: set exit code or return error
      }
      return self.runtime.get_variable(var_name).unwrap_or_default();
  }
  ```

  ## Files
  - src/executor/mod.rs (expand_braced_variable function, ~line 1154)

  ## Acceptance
  - [ ] `${x:+alt}` returns "alt" when x is set
  - [ ] `${x:+alt}` returns "" when x is unset
  - [ ] `${x:?error}` prints error to stderr when x unset
  - [ ] Works in double-quoted strings
closed_at: 2026-02-02T21:35:09.028723Z
parent: '200'
verify: rush -c "x=set; echo \${x:+alternate}" | grep -q alternate
claimed_at: 2026-02-02T21:34:50.596421Z
is_archived: true
