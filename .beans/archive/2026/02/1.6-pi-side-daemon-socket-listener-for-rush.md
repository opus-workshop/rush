id: '1.6'
title: 'Pi-side: Daemon socket listener for Rush'
slug: pi-side-daemon-socket-listener-for-rush
status: closed
priority: 2
created_at: 2026-02-03T08:38:26.334068Z
updated_at: 2026-02-03T08:47:25.244038Z
description: |-
  **This bean tracks work needed in the Pi codebase, not Rush.**

  ## Requirements for Pi

  Pi needs a daemon mode that:
  1. Listens on Unix socket (`~/.pi/rush.sock`)
  2. Accepts JSONL messages from Rush
  3. Streams LLM responses back
  4. Maintains conversation context per-session
  5. Can make tool calls back to Rush

  ## Implementation Location
  This will be implemented in the pi repository, not rush.

  ## Interface Contract
  Pi must implement the protocol defined in Rush's `src/daemon/protocol.rs`:
  - Accept `RushToPi::Query` messages
  - Send `PiToRush::Chunk` for streaming
  - Send `PiToRush::Done` when complete
  - Send `PiToRush::ToolCall` to execute commands

  ## Context Handling
  Pi should use the `ShellContext` to:
  - Set working directory for any file operations
  - Include history in system prompt for context
  - Use last_exit_code to understand if previous command failed

  ## Testing
  Create a mock Pi daemon for Rush testing:
  ```bash
  # Simple mock that echoes back
  socat UNIX-LISTEN:/tmp/pi-rush.sock,fork EXEC:"cat"
  ```
acceptance: |-
  1. Pi has a `pi daemon` command that starts the socket listener
  2. Socket is created at ~/.pi/rush.sock
  3. Accepts Query messages and streams responses
  4. Conversation context is maintained across queries in same session
  5. Can execute tool calls back through Rush
closed_at: 2026-02-03T08:47:25.244038Z
close_reason: Not needed - Pi already has RPC mode (stdin/stdout JSON-lines). Rush will spawn pi as a subprocess using the existing RpcClient protocol instead of requiring a custom daemon.
parent: '1'
claimed_at: 2026-02-03T08:42:29.064796Z
is_archived: true
