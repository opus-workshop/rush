id: '43'
title: 'STABILITY-001: Non-TTY Mode Support'
status: open
priority: 1
created_at: 2026-01-30T18:49:24.473408Z
updated_at: 2026-01-30T18:49:24.473408Z
description: |-
  As a user running rush in non-interactive contexts, I need rush to work without a TTY so that login scripts, pipes, and command substitution work correctly.

  ## Priority: P0 - BLOCKING
  This is the single most critical blocker for login shell use.

  ## Problem
  - Reedline requires TTY and crashes on non-interactive use
  - Breaks: login scripts, `echo "pwd" | rush`, `$(rush -c "cmd")`
  - Makes rush unusable for automation or as a login shell

  ## Acceptance Criteria
  - [ ] Detects TTY vs non-TTY mode using atty crate
  - [ ] Interactive mode: Uses reedline for rich line editing
  - [ ] Non-interactive mode: Uses simple stdin reader
  - [ ] `echo "pwd" | rush` works
  - [ ] `rush -c "echo test"` works (already works)
  - [ ] `rush < script.sh` works
  - [ ] `$(rush -c "echo nested")` works (command substitution)
  - [ ] Can be used in cron jobs
  - [ ] cargo test passes (all tests including non-TTY tests)
  - [ ] cargo build --release succeeds
  - [ ] cargo clippy -- -D warnings passes

  ## Technical Implementation
  ```rust
  // In main.rs
  use atty;

  fn run_interactive() -> Result<()> {
      if atty::is(atty::Stream::Stdin) {
          run_interactive_with_reedline()
      } else {
          run_non_interactive()
      }
  }

  fn run_non_interactive() -> Result<()> {
      let stdin = std::io::stdin();
      for line in stdin.lock().lines() {
          let line = line?;
          execute_line(&line, &mut executor)?;
      }
      Ok(())
  }
  ```

  ## Files to Modify
  - src/main.rs:188 - Split run_interactive() into TTY/non-TTY paths
  - Cargo.toml - Add atty dependency

  ## Testing
  - Unit tests for non-TTY execution
  - Integration test: echo commands through pipe
  - Integration test: command substitution
  - Integration test: script redirection

  ## Estimated Effort: 1-2 days
labels:
- critical
- non-tty
- p0
- rush
- stability
