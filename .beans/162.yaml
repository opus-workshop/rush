id: '162'
title: 'FOUNDATION-007: Function definitions'
status: open
priority: 2
created_at: 2026-01-30T18:49:25.316943Z
updated_at: 2026-01-30T18:49:25.316943Z
description: |-
  ## Problem
  Shell function definitions don't work.

  ## Current Behavior
  ```bash
  foo() { echo hello; }   # Error: unexpected token
  function foo { ... }    # Error: unexpected token
  ```

  ## Expected Behavior
  ```bash
  foo() { echo hello; }; foo        # Output: hello
  greet() { echo "hi $1"; }; greet world  # Output: hi world
  ret5() { return 5; }; ret5; echo $?      # Output: 5
  f() { local x=inner; echo $x; }; f       # Output: inner
  ```

  ## Implementation
  1. Parser must recognize `NAME() { BODY }` and `function NAME { BODY }`
  2. Store function definitions in runtime environment
  3. When function is called:
     - Create new scope for positional parameters
     - Execute function body
     - Handle `return` to exit function with status
  4. Support `local` variables inside functions
  5. Functions can call other functions (recursion)

  ## Test Cases
  ```bash
  test_case "function definition" 'foo() { echo hello; }; foo' 'hello'
  test_case "function with args" 'greet() { echo "hi $1"; }; greet world' 'hi world'
  test_case "function return" 'ret5() { return 5; }; ret5; echo $?' '5'
  test_case "local variables" 'f() { local x=inner; echo $x; }; x=outer; f; echo $x' $'inner\nouter'
  ```
