id: rush-hn2.1
title: Profile JSON output for tooling integration
status: open
priority: 2
created_at: 2026-01-31T16:31:29.987796Z
updated_at: 2026-01-31T16:31:29.987796Z
description: |-
  Add JSON formatter to the profiling infrastructure for tool integration.

  ## What to implement
  - ProfileFormatter::to_json() method in src/executor/profile.rs
  - -json flag handling in profile builtin command
  - Ensure valid JSON output structure with timing data

  ## Files to Modify
  - src/executor/profile.rs (add JSON formatter methods, serde derive/output)
  - src/builtins/profile.rs (add -json flag parsing and output mode)

  ## Patterns to Follow
  - Existing to_string() formatter in profile.rs - mirror for to_json()
  - Use serde_json for JSON serialization (already in Cargo.toml)

  ## Context
  ProfileMetrics struct contains: stage_name, duration_ms, count, is_builtin
  Output should include all these fields plus calculated fields like percentage
acceptance: |-
  - profile -json { ls | grep foo } outputs valid JSON
  - All timing fields present with correct precision
  - Parseable by jq: jq '.[] | select(.stage=="Parse")'
  - JSON output can be piped to external tools for analysis
  - cargo build succeeds
  - cargo test passes
parent: rush-hn2
