id: '53'
title: 'STABILITY-006: Proper Variable Expansion'
status: open
priority: 2
created_at: 2026-01-30T18:49:24.528385Z
updated_at: 2026-01-30T18:49:24.528385Z
description: |-
  As a shell scripter, I need POSIX variable expansion so that my scripts can handle defaults, errors, and string manipulation.

  ## Priority: P1 - HIGH
  Critical for POSIX compatibility.

  ## Acceptance Criteria
  - [ ] ${VAR} - Braced variables
  - [ ] ${VAR:-default} - Use default if unset
  - [ ] ${VAR:=default} - Assign default if unset
  - [ ] ${VAR:?error} - Error if unset
  - [ ] ${VAR#pattern} - Remove shortest prefix match
  - [ ] ${VAR##pattern} - Remove longest prefix match
  - [ ] ${VAR%pattern} - Remove shortest suffix match
  - [ ] ${VAR%%pattern} - Remove longest suffix match
  - [ ] Works with arrays/lists (future)
  - [ ] cargo test passes (all tests including expansion tests)
  - [ ] cargo build --release succeeds
  - [ ] cargo clippy -- -D warnings passes

  ## Technical Implementation
  ```rust
  pub fn expand_variable(&self, expr: &str) -> Result<String> {
      // Parse ${VAR:-default} syntax
      // Apply transformation based on operator
      // Return expanded value
  }
  ```

  ## Files to Modify
  - src/runtime/mod.rs - Implement variable expansion
  - src/lexer/mod.rs - Tokenize braced variables
  - src/parser/mod.rs - Parse variable expansions

  ## Testing
  - Test all expansion operators
  - Test nested expansions
  - Test edge cases (empty, unset, special chars)

  ## Estimated Effort: 2 days
labels:
- p1
- posix
- rush
- stability
- variables
