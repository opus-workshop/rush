id: '187'
title: Profile-Guided Optimization (PGO) Build
status: open
priority: 3
created_at: 2026-01-30T18:49:25.556620Z
updated_at: 2026-01-30T18:49:25.556620Z
description: |-
  ## Problem
  Rush binary may have suboptimal code layout and branch predictions for common use cases.

  ## Proposed Solution
  Implement PGO build process:

  1. **Instrument Build**: Build with profiling instrumentation
  2. **Collect Profiles**: Run representative workloads
  3. **Optimize Build**: Rebuild with profile data

  ```bash
  # Step 1: Instrumented build
  RUSTFLAGS="-Cprofile-generate=/tmp/pgo-data" cargo build --release

  # Step 2: Run workloads
  ./target/release/rush -c "exit"
  ./target/release/rush -c "echo hello"
  ./target/release/rush -c "ls"
  ./target/release/rush -c "pwd"
  # Run benchmark suite...

  # Step 3: Merge profiles
  llvm-profdata merge -o /tmp/pgo-data/merged.profdata /tmp/pgo-data

  # Step 4: Optimized build
  RUSTFLAGS="-Cprofile-use=/tmp/pgo-data/merged.profdata" cargo build --release
  ```

  ## Acceptance Criteria
  - [ ] Document PGO build process in docs/
  - [ ] Create Makefile target for PGO builds
  - [ ] Benchmark shows measurable improvement
  - [ ] CI can produce PGO-optimized releases
  - [ ] At least 10% startup improvement from PGO

  ## Expected Impact
  PGO typically provides 10-20% improvement for CLI tools.

  ## References
  - https://doc.rust-lang.org/rustc/profile-guided-optimization.html
  - https://blog.rust-lang.org/inside-rust/2020/11/11/exploring-pgo-for-the-rust-compiler.html
labels:
- build
- performance
- pgo
