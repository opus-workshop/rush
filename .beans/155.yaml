id: '155'
title: 'FOUNDATION-002: Implement glob expansion'
status: open
priority: 1
created_at: 2026-01-30T18:49:25.248470Z
updated_at: 2026-01-30T18:49:25.248470Z
description: |-
  Implement glob pattern expansion for wildcards.

  ## Problem
  Glob patterns produce lexer errors:
  ```bash
  ls *.rs           # Error: Invalid token at position 3: '*'
  echo src/*.txt    # Error: Invalid token
  rm -f *.bak       # Error: Invalid token
  ```

  ## Root Cause
  The lexer has no token definition for `*` in filename context. It's only recognized as part of `$*` (special variable).

  ## Solution
  1. **Lexer**: Recognize glob patterns as valid tokens
  2. **Parser**: Parse glob patterns as arguments
  3. **Executor**: Expand globs before command execution

  ```rust
  // In lexer - recognize glob characters in word context
  #[regex(r"[^\s|;&()<>\"'`$\\]*[*?]+[^\s|;&()<>\"'`$\\]*")]
  GlobPattern(String),

  // Or integrate into Word token
  #[regex(r"[^\s|;&()<>\"'`$\\]+")]
  Word(String),  // Then check for glob chars during expansion
  ```

  In executor, before running command:
  ```rust
  fn expand_globs(args: Vec<String>) -> Vec<String> {
      args.into_iter()
          .flat_map(|arg| {
              if contains_glob_chars(&arg) {
                  glob::glob(&arg).map(|paths| paths.collect()).unwrap_or(vec![arg])
              } else {
                  vec![arg]
              }
          })
          .collect()
  }
  ```

  ## Acceptance Criteria
  - [ ] `ls *.rs` lists all .rs files
  - [ ] `echo *.txt` expands to matching files
  - [ ] `ls src/**/*.rs` works (recursive glob)
  - [ ] `ls file?.txt` works (single char wildcard)
  - [ ] `ls [abc].txt` works (character class)
  - [ ] Non-matching glob returns literal (or error based on nullglob)
  - [ ] Quoted globs are not expanded: `echo "*.rs"` prints `*.rs`
  - [ ] Smoke test: glob tests pass

  ## Files to Modify
  - `src/lexer/mod.rs` - Token definitions
  - `src/executor/mod.rs` - Glob expansion before execution
  - May use `glob` crate (already in Cargo.toml)

  ## Test Cases
  ```bash
  ./tests/smoke_test.sh | grep -A2 "GLOB EXPANSION"
  ```
labels:
- critical
- foundation
- lexer
- parser
