id: '137'
title: Optional git2 Feature Flag for Binary Size
status: open
priority: 2
created_at: 2026-01-30T18:49:25.099329Z
updated_at: 2026-01-30T18:49:25.099329Z
description: |-
  ## Problem
  The `git2` crate (v0.19) links libgit2 and OpenSSL statically, adding significant binary bloat. Not all Rush users need native git builtins — many use the external `git` command. Making this optional would reduce binary size for users who don't need it.

  ## Evidence
  - Rush binary: 5.5MB — git2/libgit2/OpenSSL contribute significantly
  - git2 is used for: `git_status`, `git_log`, `git_diff` builtins
  - Users running Rush as a general-purpose shell may not need these
  - Smaller binary = faster cold start (fewer pages to map)

  ## Implementation
  1. Add feature flag in Cargo.toml:
  ```toml
  [features]
  default = ["git-builtins"]
  git-builtins = ["git2"]

  [dependencies]
  git2 = { version = "0.19", optional = true }
  ```

  2. Gate git builtin registration with `#[cfg(feature = "git-builtins")]`
  3. Gate git builtin modules with `#[cfg(feature = "git-builtins")]`
  4. Ensure `cargo build --release --no-default-features` produces a working shell without git builtins
  5. Measure binary size with and without the feature

  ## Acceptance Criteria
  - [ ] git2 is an optional dependency behind `git-builtins` feature
  - [ ] `cargo build --release` (default) includes git builtins as before
  - [ ] `cargo build --release --no-default-features` builds without git2
  - [ ] Binary size difference documented
  - [ ] `cargo test` passes with both feature configurations
labels:
- binary-size
- feature-flag
- performance
verify: 'cargo build --release && cargo test && cargo clippy -- -D warnings'
