id: '144'
title: 'FOUNDATION-001: Fix lexer dot-splitting in filenames'
status: open
priority: 1
created_at: 2026-01-30T18:49:25.154534Z
updated_at: 2026-01-30T18:49:25.154534Z
description: |-
  Fix the lexer so filenames with dots are tokenized as single words.

  ## Problem
  `README.md` is tokenized as three tokens: `README` (Identifier) + `.` (Dot) + `md` (Identifier)

  This breaks every command with a dotted filename:
  ```bash
  cat README.md      # FAILS: cat gets 3 arguments
  ls Cargo.toml      # FAILS: ls gets 3 arguments
  ./script.sh        # FAILS: splits on dot
  ```

  ## Root Cause
  In `src/lexer/mod.rs`:
  ```rust
  #[token(".")]
  Dot,

  #[regex(r"[a-zA-Z_][a-zA-Z0-9_-]*")]
  Identifier(String),
  ```

  Dot is a separate token, and identifiers can't contain dots.

  ## Solution
  Modify the `Identifier` regex to include dots when they're part of a filename:
  ```rust
  // Option 1: Allow dots in identifiers (except leading)
  #[regex(r"[a-zA-Z_][a-zA-Z0-9_.-]*")]
  Identifier(String),

  // Option 2: Create a Word token for unquoted words
  #[regex(r"[^\s|;&()<>\"'`$\\]+")]
  Word(String),
  ```

  The tricky part is that `.` alone should still be a valid token (current directory), but `foo.bar` should be one token.

  ## Acceptance Criteria
  - [ ] `echo README.md` outputs `README.md` (one argument)
  - [ ] `cat Cargo.toml` works without quotes
  - [ ] `ls file.tar.gz` works (multiple dots)
  - [ ] `./script.sh` works (dot-slash prefix)
  - [ ] `.` alone still works as current directory
  - [ ] `..` works as parent directory
  - [ ] Smoke test: filename tests pass

  ## Files to Modify
  - `src/lexer/mod.rs` - Token definitions

  ## Test Cases
  ```bash
  ./tests/smoke_test.sh | grep -A2 "FILENAME HANDLING"
  ```
labels:
- critical
- foundation
- lexer
