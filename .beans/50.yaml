id: '50'
title: 'STABILITY-003: File Redirection Support'
status: open
priority: 1
created_at: 2026-01-30T18:49:24.511704Z
updated_at: 2026-01-30T18:49:24.511704Z
description: |-
  As a shell user, I need standard Unix redirections so that I can redirect output to files and chain commands properly.

  ## Priority: P0 - BLOCKING
  Essential for basic shell scripting.

  ## Problem
  - No `>`, `>>`, `<`, `2>`, `2>&1`, `&>` support
  - Cannot save command output to files
  - Cannot redirect error streams

  ## Acceptance Criteria
  - [ ] `>` stdout redirect: `echo "test" > file.txt`
  - [ ] `>>` append redirect: `echo "more" >> file.txt`
  - [ ] `<` stdin redirect: `command < input.txt`
  - [ ] `2>` stderr redirect: `command 2> errors.log`
  - [ ] `2>&1` stderr to stdout: `command 2>&1 | grep error`
  - [ ] `&>` both to file: `command &> output.log`
  - [ ] Works with pipes: `cmd | grep foo > results.txt`
  - [ ] File permissions handled correctly
  - [ ] Handles missing parent directories gracefully
  - [ ] cargo test passes (all tests including redirection tests)
  - [ ] cargo build --release succeeds
  - [ ] cargo clippy -- -D warnings passes

  ## Technical Implementation
  ```rust
  // In parser/ast.rs
  pub enum Redirect {
      Stdout(PathBuf),       // >
      StdoutAppend(PathBuf), // >>
      Stdin(PathBuf),        // <
      Stderr(PathBuf),       // 2>
      StderrToStdout,        // 2>&1
      Both(PathBuf),         // &>
  }

  pub struct Command {
      // ... existing fields
      pub redirects: Vec<Redirect>,
  }
  ```

  ## Files to Modify
  - src/parser/ast.rs - Add Redirect enum to AST
  - src/lexer/mod.rs - Tokenize redirect operators
  - src/parser/mod.rs - Parse redirections
  - src/executor/mod.rs - Set up file descriptors before exec

  ## Testing
  - Test all redirect operators individually
  - Test redirect with pipes
  - Test redirect with builtins
  - Test redirect file permissions
  - Test redirect error handling (read-only filesystem, etc.)

  ## Estimated Effort: 2 days
labels:
- critical
- p0
- redirection
- rush
- stability
